{% extends "base.html" %}
{% load static %}

{% block category %}
<div class="collapse navbar-collapse">
	<ul class="navbar-nav mr-auto">
		<li class="nav-item">
			<a class="nav-link" href="{% url 'index' %}">Home</a>
		</li>
		<li class="nav-item dropdown">
			<a class="nav-link dropdown-toggle" href="#">Categories</a>
			<ul class="dropdown-menu">
				{% for cat in category %}
				<li><a class="dropdown-item" href="{% url 'category' cat.slug %}">{{cat.name}}</a></li>
				{% endfor %}
			</ul>
		</li>
	</ul>
</div>
{% endblock category %}

{% block body %}
<!-- section main content -->
<section class="main-content mt-3">
	<div class="container-xl">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
				<li class="breadcrumb-item"><a href="{% url 'category' post.category.slug %}">{{post.category.name}}</a></li>
				<li class="breadcrumb-item active" aria-current="page">{{post.title}}</li>
			</ol>
		</nav>

		<div class="row gy-4">
			<div class="col-lg-8">
				<!-- post single -->
				<div class="post post-single">
					<!-- post header -->
					<div class="post-header">
						<h1 class="title mt-0 mb-3">{{post.title}}</h1>
						<ul class="meta list-inline mb-0">
							<li class="list-inline-item"><a href="#">{{post.author}}</a></li>
							<li class="list-inline-item"><a href="{% url 'category' post.category.slug %}">{{post.category.name}}</a></li>
							<li class="list-inline-item">{{post.date|date:"F d, Y"}}</li>
						</ul>
					</div>
					
					<!-- featured image -->
					<div class="featured-image">
						<img src="{{post.img.url}}" alt="{{post.title}}" />
					</div>
					
					<!-- post content -->
					<div class="post-content clearfix">
						<p>{{post.content}}</p>
						
						<p>Everyone realizes why a new common language would be desirable: one could refuse to pay expensive translators. To achieve this, it <mark>would be</mark> necessary to have uniform grammar, pronunciation and more common words.</p>

						<figure class="figure">
							<img src="{% static 'images/posts/post-lg-2.jpg' %}" class="figure-img img-fluid rounded" alt="content">
							<figcaption class="figure-caption text-center">A caption for the above image.</figcaption>
						</figure>

						<p>The languages only differ in their grammar, their pronunciation and their most common words. Everyone realizes why a new common language would be desirable.</p> 
						
						<img src="{% static 'images/posts/single-sm-1.jpg' %}" class="rounded alignleft" alt="content">
						<p>{{post.content}}</p>
					</div>
					
					<!-- post bottom section -->
					<div class="post-bottom">
						<div class="row d-flex align-items-center">
							<div class="col-md-6 col-12 text-center text-md-start">
								<!-- tags -->
								<a href="#" class="tag">#{{post.section}}</a>
								<a href="{% url 'category' post.category.slug %}" class="tag">#{{post.category.name}}</a>
								<a href="#" class="tag">#Featured</a>
							</div>
							<div class="col-md-6 col-12">
								<!-- social icons -->
								<ul class="social-icons list-unstyled list-inline mb-0 float-md-end">
									<li class="list-inline-item"><a href="#"><i class="fab fa-facebook-f"></i></a></li>
									<li class="list-inline-item"><a href="#"><i class="fab fa-twitter"></i></a></li>
									<li class="list-inline-item"><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
									<li class="list-inline-item"><a href="#"><i class="fab fa-pinterest"></i></a></li>
									<li class="list-inline-item"><a href="#"><i class="fab fa-telegram-plane"></i></a></li>
									<li class="list-inline-item"><a href="#"><i class="far fa-envelope"></i></a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>

				<div class="spacer" data-height="50"></div>

				<!-- about author -->
				<div class="about-author padding-30 rounded">
					<div class="thumb">
						<img src="{% static 'images/other/avatar-about.png' %}" alt="{{post.author}}" />
					</div>
					<div class="details">
						<h4 class="name"><a href="#">{{post.author}}</a></h4>
						<p>Hello, I'm a content writer who is fascinated by content fashion, celebrity and lifestyle. She helps clients bring the right content to the right people.</p>
						<ul class="social-icons list-unstyled list-inline mb-0">
							<li class="list-inline-item"><a href="#"><i class="fab fa-facebook-f"></i></a></li>
							<li class="list-inline-item"><a href="#"><i class="fab fa-twitter"></i></a></li>
							<li class="list-inline-item"><a href="#"><i class="fab fa-instagram"></i></a></li>
							<li class="list-inline-item"><a href="#"><i class="fab fa-pinterest"></i></a></li>
							<li class="list-inline-item"><a href="#"><i class="fab fa-medium"></i></a></li>
							<li class="list-inline-item"><a href="#"><i class="fab fa-youtube"></i></a></li>
						</ul>
					</div>
				</div>

				<div class="spacer" data-height="50"></div>

				<!-- section header -->
				<div class="section-header">
					<h3 class="section-title">Comments ({{ comments.count }})</h3>
					<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
				</div>

				<!-- post comments -->
				<div class="comments bordered padding-30 rounded">
					<ul class="comments">
						{% for comment in comments %}
						<li class="comment rounded">
							<div class="thumb">
								<img src="{% static 'images/other/comment-1.png' %}" alt="{{ comment.name }}" />
							</div>
							<div class="details">
								<h4 class="name"><a href="#">{{ comment.name }}</a></h4>
								<span class="date">{{ comment.date|date:"F d, Y - h:i A" }}</span>
								<p>{{ comment.comment }}</p>
								<a href="#comment-form" class="btn btn-default btn-sm reply-btn" data-comment-id="{{ comment.id }}" data-comment-name="{{ comment.name }}">Reply</a>
								
								<!-- Nested Replies -->
								{% if comment.replies.all %}
								<ul class="comments replied">
									{% for reply in comment.replies.all %}
									<li class="comment child rounded">
										<div class="thumb">
											<img src="{% static 'images/other/comment-1.png' %}" alt="{{ reply.name }}" />
										</div>
										<div class="details">
											<h4 class="name"><a href="#">{{ reply.name }}</a></h4>
											<span class="date">{{ reply.date|date:"F d, Y - h:i A" }}</span>
											<p>{{ reply.comment }}</p>
										</div>
									</li>
									{% endfor %}
								</ul>
								{% endif %}
							</div>
						</li>
						{% empty %}
						<li class="text-center py-4">
							<p>No comments yet. Be the first to comment!</p>
						</li>
						{% endfor %}
					</ul>
				</div>

				<div class="spacer" data-height="50"></div>

				<!-- section header -->
				<div class="section-header">
					<h3 class="section-title">Leave Comment</h3>
					<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
				</div>

				<!-- comment form -->
				<div class="comment-form rounded bordered padding-30" id="comment-form">
					<!-- Reply indicator -->
					<div id="reply-info" style="display:none; margin-bottom:15px; padding:10px; background:#f0f0f0; border-radius:5px; border-left:3px solid #007bff;">
						<strong>Replying to:</strong> <span id="reply-name"></span>
						<button type="button" onclick="cancelReply()" style="float:right; border:none; background:transparent; cursor:pointer; font-size:20px; color:#666;">&times;</button>
					</div>

					<form method="post" action="{% url 'add_comment' post.blog_slug %}">
						{% csrf_token %}
						
						<div class="row">
							<div class="column col-md-12">
								<div class="form-group">
									<textarea name="InputComment" id="InputComment" class="form-control" rows="4" placeholder="Your comment here..." required></textarea>
								</div>
							</div>
							
							<div class="column col-md-6">
								<div class="form-group">
									<input type="email" class="form-control" name="InputEmail" id="InputEmail" placeholder="Email address" required>
								</div>
							</div>
							
							<div class="column col-md-6">
								<div class="form-group">
									<input type="url" class="form-control" name="InputWeb" id="InputWeb" placeholder="Website (optional)">
								</div>
							</div>
							
							<div class="column col-md-12">
								<div class="form-group">
									<input type="text" class="form-control" name="InputName" id="InputName" placeholder="Your name" required>
								</div>
							</div>
							
							<!-- Hidden fields -->
							<input type="hidden" name="parent_id" id="parent_id" value="">
						</div>
						
						<button type="submit" class="btn btn-default">Submit Comment</button>
					</form>
				</div>
			</div>

			<div class="col-lg-4">
				<!-- sidebar -->
				<div class="sidebar">
					<!-- widget about -->
					<div class="widget rounded">
						<div class="widget-about data-bg-image text-center" data-bg-image="{% static 'images/map-bg.png' %}">
							<img src="{% static 'images/logo.svg' %}" alt="logo" class="mb-4" />
							<p class="mb-4">Hello, We're content writer who is fascinated by content fashion, celebrity and lifestyle.</p>
							<ul class="social-icons list-unstyled list-inline mb-0">
								<li class="list-inline-item"><a href="#"><i class="fab fa-facebook-f"></i></a></li>
								<li class="list-inline-item"><a href="#"><i class="fab fa-twitter"></i></a></li>
								<li class="list-inline-item"><a href="#"><i class="fab fa-instagram"></i></a></li>
								<li class="list-inline-item"><a href="#"><i class="fab fa-pinterest"></i></a></li>
								<li class="list-inline-item"><a href="#"><i class="fab fa-medium"></i></a></li>
								<li class="list-inline-item"><a href="#"><i class="fab fa-youtube"></i></a></li>
							</ul>
						</div>
					</div>

					<!-- widget popular posts -->
					<div class="widget rounded">
						<div class="widget-header text-center">
							<h3 class="widget-title">Popular Posts</h3>
							<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
						</div>
						<div class="widget-content">
							{% for blog in posts %}
							<div class="post post-list-sm circle">
								<div class="thumb circle">
									<span class="number">{{ forloop.counter }}</span>
									<a href="{% url 'blog_detail' blog.blog_slug %}">
										<div class="inner">
											<img src="{{ blog.img.url }}" alt="{{ blog.title }}" />
										</div>
									</a>
								</div>
								<div class="details clearfix">
									<h6 class="post-title my-0"><a href="{% url 'blog_detail' blog.blog_slug %}">{{ blog.title }}</a></h6>
									<ul class="meta list-inline mt-1 mb-0">
										<li class="list-inline-item">{{ blog.date|date:"F d, Y" }}</li>
									</ul>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>

					<!-- widget categories -->
					<div class="widget rounded">
						<div class="widget-header text-center">
							<h3 class="widget-title">Explore Topics</h3>
							<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
						</div>
						<div class="widget-content">
							<ul class="list">
								{% for cat in category %}
								<li><a href="{% url 'category' cat.slug %}">{{ cat.name }}</a><span>({{ cat.blogs.count }})</span></li>
								{% endfor %}
							</ul>
						</div>
					</div>

					<!-- widget newsletter -->
					<div class="widget rounded">
						<div class="widget-header text-center">
							<h3 class="widget-title">Newsletter</h3>
							<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
						</div>
						<div class="widget-content">
							<span class="newsletter-headline text-center mb-3">Join 70,000 subscribers!</span>
							<form>
								<div class="mb-2">
									<input class="form-control w-100 text-center" placeholder="Email address…" type="email">
								</div>
								<button class="btn btn-default btn-full" type="submit">Sign Up</button>
							</form>
							<span class="newsletter-privacy text-center mt-3">By signing up, you agree to our <a href="#">Privacy Policy</a></span>
						</div>
					</div>

					<!-- widget advertisement -->
					<div class="widget no-container rounded text-md-center">
						<span class="ads-title">- Sponsored Ad -</span>
						<a href="#" class="widget-ads">
							<img src="{% static 'images/ads/ad-360.png' %}" alt="Advertisement" />	
						</a>
					</div>

					<!-- widget tags -->
					<div class="widget rounded">
						<div class="widget-header text-center">
							<h3 class="widget-title">Tag Clouds</h3>
							<img src="{% static 'images/wave.svg' %}" class="wave" alt="wave" />
						</div>
						<div class="widget-content">
							<a href="#" class="tag">#Trending</a>
							<a href="#" class="tag">#Video</a>
							<a href="#" class="tag">#Featured</a>
							<a href="#" class="tag">#Gallery</a>
							<a href="#" class="tag">#Celebrities</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- instagram feed -->
<div class="instagram">
	<div class="container-xl">
		<a href="#" class="btn btn-default btn-instagram">@Katen on Instagram</a>
		<div class="instagram-feed d-flex flex-wrap">
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-1.jpg' %}" alt="insta" /></a>
			</div>
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-2.jpg' %}" alt="insta" /></a>
			</div>
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-3.jpg' %}" alt="insta" /></a>
			</div>
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-4.jpg' %}" alt="insta" /></a>
			</div>
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-5.jpg' %}" alt="insta" /></a>
			</div>
			<div class="insta-item col-sm-2 col-6 col-md-2">
				<a href="#"><img src="{% static 'images/insta/insta-6.jpg' %}" alt="insta" /></a>
			</div>
		</div>
	</div>
</div>

<!-- Reply functionality JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
	// Reply button functionality
	const replyButtons = document.querySelectorAll('.reply-btn');
	
	replyButtons.forEach(function(btn) {
		btn.addEventListener('click', function(e) {
			e.preventDefault();
			
			const commentId = this.getAttribute('data-comment-id');
			const commentName = this.getAttribute('data-comment-name');
			
			// Set parent ID
			document.getElementById('parent_id').value = commentId;
			
			// Show reply info
			document.getElementById('reply-name').textContent = commentName;
			document.getElementById('reply-info').style.display = 'block';
			
			// Scroll to form
			document.getElementById('comment-form').scrollIntoView({ 
				behavior: 'smooth',
				block: 'start'
			});
			
			// Focus on comment textarea
			document.getElementById('InputComment').focus();
		});
	});
});

function cancelReply() {
	// Clear parent ID
	document.getElementById('parent_id').value = '';
	
	// Hide reply info
	document.getElementById('reply-info').style.display = 'none';
	
	// Clear reply name
	document.getElementById('reply-name').textContent = '';
}
</script>
{% endblock body %}